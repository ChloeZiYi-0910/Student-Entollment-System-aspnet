@page
@model StudentEnrollmentSystem.Pages.AccountDetails.UpdateProfileModel
@{
    ViewData["Title"] = "Update Contact Information";
}
<link rel="stylesheet" href="~/css/AccountDetails.css">
<div class="container light-style flex-grow-1 container-p-y">
    <h4 class="font-weight-bold py-3 mb-4">Account Settings</h4>
    <div class="card overflow-hidden">
        <div class="row no-gutters row-bordered row-border-light">
            <div class="col-md-3 pt-0">
                <div class="list-group list-group-flush account-settings-links">
                    <a class="list-group-item list-group-item-action" asp-page="/AccountDetails/StudentDetails">General Information</a>
                    <a class="list-group-item list-group-item-action active" asp-page="/AccountDetails/UpdateContactInformation">Update Contact Information</a>
                    <a class="list-group-item list-group-item-action" asp-page="/AccountDetails/UpdatePaymentDetails">Update Payment Details</a>
                    <a class="list-group-item list-group-item-action" asp-page="/AccountDetails/ChangePassword">Change Password</a>
                </div>
            </div>
            <div class="col-md-9">
                <div class="card-body">
                    <form method="post">
                        <hr class="border-light m-0">
                        <div class="card-body pb-0 mb-2">
                            <h6 class="mb-3">Address</h6>
                            <div class="form-group mb-3">
                                <label class="form-label mb-0">Address Line</label>
                                <input type="text" class="form-control" asp-for="ContactInformations.AddressLine" id="address_line" required>
                                <span asp-validation-for="ContactInformations.AddressLine" class="text-danger"></span>
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label mb-0">Postcode</label>
                                <input type="text" class="form-control" asp-for="ContactInformations.Postcode" id="postcode" required>
                                <span asp-validation-for="ContactInformations.Postcode" class="text-danger"></span>
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label mb-0">City</label>
                                <input type="text" class="form-control" asp-for="ContactInformations.City" id="city" required>
                                <span asp-validation-for="ContactInformations.City" class="text-danger"></span>
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label mb-0">State</label>
                                <select class="form-select" asp-for="ContactInformations.State" id="state" required>
                                    <option value="" selected disabled>Select State</option>
                                    <option value="Johor">Johor</option>
                                    <option value="Kedah">Kedah</option>
                                    <option value="Kelantan">Kelantan</option>
                                    <option value="Malacca">Malacca</option>
                                    <option value="Negeri Sembilan">Negeri Sembilan</option>
                                    <option value="Pahang">Pahang</option>
                                    <option value="Penang">Penang</option>
                                    <option value="Perak">Perak</option>
                                    <option value="Perlis">Perlis</option>
                                    <option value="Sabah">Sabah</option>
                                    <option value="Sarawak">Sarawak</option>
                                    <option value="Selangor">Selangor</option>
                                    <option value="Terengganu">Terengganu</option>
                                    <option value="Wilayah Persekutuan">Wilayah Persekutuan</option>
                                    <option value="Overseas">Overseas</option>
                                </select>
                                <span asp-validation-for="ContactInformations.State" class="text-danger"></span>
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label mb-0">Country</label>
                                <select class="form-select" asp-for="ContactInformations.Country" id="country" required>
                                    <option value="" selected disabled>Select Country</option>
                                    <option value="Malaysia">Malaysia</option>
                                    <option value="Overseas">Overseas</option>
                                </select>
                                <span asp-validation-for="ContactInformations.Country" class="text-danger"></span>
                            </div>
                        </div>
                        <hr class="border-secondary m-0">
                        <div class="card-body">
                            <h6 class="mb-3">Emergency Contact</h6>
                            <div class="form-group mb-3">
                                <label class="form-label mb-0">Relationship</label>
                                <select class="form-select" asp-for="ContactInformations.Relationship" id="relationship" required>
                                    <option value="" selected disabled>Select Relationship</option>
                                    <option value="Father">Father</option>
                                    <option value="Mother">Mother</option>
                                    <option value="Guardian">Guardian</option>
                                    <option value="Friend">Friend</option>
                                    <option value="Relative">Relative</option>
                                </select>
                                <span asp-validation-for="ContactInformations.Relationship" class="text-danger"></span>
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label mb-0">Contact Person</label>
                                <input type="text" class="form-control" asp-for="ContactInformations.ContactPerson" id="contactperson" required>
                                <span asp-validation-for="ContactInformations.ContactPerson" class="text-danger"></span>
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label mb-0">HP No.</label>
                                <input type="text" class="form-control" asp-for="ContactInformations.HPNo" id="emergencycontact_HPNo">
                                <span asp-validation-for="ContactInformations.HPNo" class="text-danger"></span>
                            </div>
                        </div>
                        @if (!string.IsNullOrEmpty(Model.SuccessMessage))
                        {
                            <div class="alert alert-success">@Model.SuccessMessage</div>
                        }
                        @if (!string.IsNullOrEmpty(Model.ErrorMessage))
                        {
                            <div class="alert alert-danger">@Model.ErrorMessage</div>
                        }
                        <div class="d-flex justify-content-end mt-3">
                            <button type="submit" class="btn btn-primary me-4">Save Changes</button>
                            <a asp-page="/Home" class="btn btn-back btn-outline-success">Back to Home</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        // Check initial country value
        if ($('#country').val() === 'Overseas') {
            $('#state').val('Overseas').prop('disabled', true);
        }

        // Handle country change
        $('#country').change(function() {
            if ($(this).val() === 'Overseas') {
                // If Overseas is selected, set state to Overseas and disable it
                $('#state').val('Overseas').prop('disabled', true);
            } else {
                // If Malaysia is selected, enable state dropdown
                $('#state').prop('disabled', false);
                // Reset to default if previously set to Overseas
                if ($('#state').val() === 'Overseas') {
                    $('#state').val('');
                }
            }
        });

        // Form submission handler
        $('form').submit(function() {
            // Enable the state dropdown before submitting to ensure the value is sent
            $('#state').prop('disabled', false);
            return true;
        });
    });
</script>
